<!DOCTYPE html>
<html>
<head>
<title>WSL で Docker する話 (2018-12 時点)</title>
<!-- 2018-12-03 Mon 23:07 -->
<meta  charset="utf-8">
<meta  name="generator" content="Org-mode">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css" href="/css/prelude.css" />
<link rel="stylesheet" type="text/css" href="/css/highlight.css" />
</head>
<body>
<div id="content">
<h1 class="title">WSL で Docker する話 (2018-12 時点)</h1>
<div class="location">
<p>
https://<a href="/">bydriv.github.io</a>/<a href="/blog">blog</a>/<strong>wsl-docker-2018-12.html</strong>
</p>

</div>

<div class="created_at">
<p>
created at <time datetime="2018-12-03">2018-12-03</time>
</p>

</div>

<div class="updated_at">
<p>
updated at <time datetime="2018-12-03">2018-12-03</time>
</p>

</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">CAUTION!</h2>
<div class="outline-text-2" id="text-1">
<div class="center">
<p>
<b>注意: 2018年12月3日時点の情報である。</b>
<i>将来は通用しない可能性が高いので注意すること</i>
</p>
</div>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">結論</h2>
<div class="outline-text-2" id="text-2">
<ul class="org-ul">
<li><b>docker</b> コマンドは、 <b>Ubuntu 18.04 かつ Docker 17.09.0 なら使える。</b>
</li>
<li><b>docker-compose</b> コマンドは、 <b>iptables を諦めれば使える。</b>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">注意</h2>
<div class="outline-text-2" id="text-3">
<div class="center">
<p>
<b>apt でインストールしてはならない</b> (<i>ほとんどのパッケージは apt でインストールしても問題なく使えるが、 docker は例外</i>)
</p>
</div>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4">手順</h2>
<div class="outline-text-2" id="text-4">
<ul class="org-ul">
<li><b>docker</b>: <a href="https://qiita.com/guchio/items/3eb0818df44fdbab3d14">https://qiita.com/guchio/items/3eb0818df44fdbab3d14</a>
</li>
<li><b>docker-compose</b>: 問題はふたつあり、ひとつは <b>iptables</b> が動かないことで <b>完全に動作する方法はいまのところない(すくなくともわたしが調査した範囲では)。</b>
  しかし <b>オプションで iptables を無効にすることで無理やり動かすことはできる。</b>
  そのためには、 <b>/etc/docker/daemon.json</b> につぎのように書く:
</li>
</ul>

<pre class="example">
{
  "iptables": false
}
</pre>

<p>
<i>Note</i>: <b>/etc/docker/daemon.json</b> は <b>/usr/bin/dockerd</b> のオプションを書く json ファイルで使えるオプションは <b>man dockerd</b> などで調べる
</p>

<p>
<b>docker-compose</b> のもうひとつの問題は <b>docker login</b> がうまく動かなくなることでこれは <b>apt</b> で <b>docker-compose</b> のインストールをしたときついてくるパッケージが古いことが問題。
よって <b>pip</b> で <b>docker-compose</b> をインストールすればよい (パッケージも更新されているので)。
対策はこれ: <a href="https://kometchtech.blog.fc2.com/blog-entry-2145.html">https://kometchtech.blog.fc2.com/blog-entry-2145.html</a>
</p>
</div>
</div>

<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5">まとめ</h2>
<div class="outline-text-2" id="text-5">
<ul class="org-ul">
<li><b>docker</b> は <b>apt ではなく 17.09.0 の deb を直接インストールする</b>
</li>
<li><b>docker-compose</b> は
<ul class="org-ul">
<li><b>pip</b> でインストールし、
</li>
<li><b>/etc/docker/daemon.json</b> で <b>iptables</b> を無効にすれば使える
<ul class="org-ul">
<li><b>iptables</b> が必要な場合はおとなしく VMWare を使おう！
</li>
</ul>
</li>
</ul>
</li>
</ul>

<p>
<i>Note</i>: <i>上記の両方とも、将来の WSL や Docker のアップデートで解決されるかもしれないので、この記事の情報が古いなと感じた場合、まず最新の方法を試すことをおすすめする。</i>
</p>
</div>
</div>
</div>
</body>
</html>
