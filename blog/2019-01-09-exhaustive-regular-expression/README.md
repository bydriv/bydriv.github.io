# 草案: 正規表現の網羅性チェックをできる言語

具体的になにかを実装したわけではないのだけど、アイディアを書きとめておく。
これは数年前から考えてたことなのだけど、当分実装することはないだろうと思うので。

正規表現は（すくなくとも正規言語の範囲なら、理論的には）網羅性チェックができる。
正規表現を言語に組みこめば、 ML のようなパターンマッチで網羅性チェックできる正規表現が可能になる。
なんか、こんな感じに:

```sml
(* String.size s = 0 や String.size s >= 2 の文字列にマッチしないので網羅的ではなく、コンパイルエラーになる *)
fun f s =
  case s of
    /./ => x

(* やはり String.size s = 0 の文字列にマッチしないので網羅的ではなく、コンパイルエラーになる *)
fun g s =
  case s of
    /./ => x
  | /.+/ => xs

(* OK *)
fun h s =
  case s of
    /./ => SOME x
  | /.+/ => SOME xs
  | // => NONE
```

具体的な実装方法としては、

1. 正規表現を DFA に変換する
2. その DFA の和をとる
3. その DFA を最小化する
4. その DFA が `/.*/` と等しいか検査し、等しくなければ網羅的でないとしてコンパイルエラーにする

となる。

もちろん理論的には可能というだけで、実際にこれを実装しようとするとコンパイル時間が爆発してしまうことは容易に想像できる。
そのあたりをどう最適化するかは、プログラマの腕の見せ所（？）だと思う。

また、この場合当然ながら正規表現は第一級の対象ではなくなる。
たとえばユーザの入力にもとづいて動的に正規表現を構築することはできない。
(それをするのが正しいかどうかは置いといて)
