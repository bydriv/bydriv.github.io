#h2 Anne: 軽量データ形式

Anne という軽量データ形式をつくったので紹介する。

#h3 なぜつくったのか

みんな大好き自作軽量マークアップ言語開発。

なんだけど、わたしがほしいのは軽量マークアップ言語[#b としても]使えるデータ形式であって、
軽量マークアップ言語[#b のための]データ形式ではないのだ。

なので、 Anne はどちらかといえば JSON だとか YAML に近いもので、
あくまで軽量マークアップ言語として使えるくらい軽量な構文をもつ、
単なるデータ形式にすぎない。

#h3 Anne の定義

Anne の予約語は [#code \[], [#code \]], [#code \\], [#code \`], [#code \\n\\n+] のいつつのみ。
そのほかの記号はすべて文字列として解釈される。

文字列は [#code \\n\\n+], つまり空行(2つ以上の連続する改行記号)によって区切られる。

[#code \\] は特殊文字を表したり、直後の文字をエスケープしたりするためにもちいる。
[#code \`] でかこんだものはすべてエスケープされる。
[#code \\n] は改行文字を表す文字列となる。
([#code \`n\`] と [#code \\n] は意味が違うことに注意)

空行を区切り文字とする性格上、空行はすべて取りのぞかれる。
もし明示的に空行を挿入したい場合、 [#code \\n\\n] などと書く。

#h4 文法

#table
  [#tr
    [#td [#em anne]] [#td ::=] [#td [#em exps]]]
  [#tr
    [#td [#em exp]] [#td ::=] [#td [#b STRING]]]
  [#tr
    [#td [       ]] [#td   |] [#td [#code \[] [#em exps] [#code \]]]]
  [#tr
    [#td [#em exps]] [#td ::=] [#td ]]
  [#tr
    [#td [        ]] [#td   |] [#td [#em exp] [#em exps]]]

#h3 例

#pre `
#h3 Anne の定義

Anne の予約語は [#code \[], [#code \]], [#code \\], [#code \`], [#code \\n\\n+] のいつつのみ。
そのほかの記号はすべて文字列として解釈される。

文字列は [#code \\n\\n+], つまり空行(2つ以上の連続する改行記号)によって区切られる。

[#code \\] は特殊文字を表したり、直後の文字をエスケープしたりするためにもちいる。
[#code \`] でかこんだものはすべてエスケープされる。
[#code \\n] は改行文字を表す文字列となる。
([#code \`n\`] と [#code \\n] は意味が違うことに注意)

空行を区切り文字とする性格上、空行はすべて取りのぞかれる。
もし明示的に空行を挿入したい場合、 [#code \\n\\n] などと書く。

#h4 文法

#table
  [#tr
    [#td [#em anne]] [#td ::=] [#td [#em exps]]]
  [#tr
    [#td [#em exp]] [#td ::=] [#td [#b STRING]]]
  [#tr
    [#td [       ]] [#td   |] [#td [#code \[] [#em exps] [#code \]]]]
  [#tr
    [#td [#em exps]] [#td ::=] [#td ]]
  [#tr
    [#td [        ]] [#td   |] [#td [#em exp] [#em exps]]]
`

これは

#pre `
  [
    "#h3 Anne の定義"
  ],
  [
    "Anne の予約語は ",
    [
      "#code ["
    ],
    ", ",
    [
      "#code ]"
    ],
    ", ",
    [
      "#code \\"
    ],
    ", ",
    [
      "#code `"
    ],
    ", ",
    [
      "#code \\n\\n+"
    ],
    " のいつつのみ。\nそのほかの記号はすべて文字列として解釈される。"
  ],
  [
    "文字列は ",
    [
      "#code \\n\\n+"
    ],
    ", つまり空行(2つ以上の連続する改行記号)によって区切られる。"
  ],
  [
    [
      "#code \\"
    ],
    " は特殊文字を表したり、直後の文字をエスケープしたりするためにもちいる。",
    [
      "#code `"
    ],
    " でかこんだものはすべてエスケープされる。",
    [
      "#code \\n"
    ],
    " は改行文字を表す文字列となる。\n(",
    [
      "#code `n`"
    ],
    " と ",
    [
      "#code \\n"
    ],
    " は意味が違うことに注意)"
  ],
  [
    "空行を区切り文字とする性格上、空行はすべて取りのぞかれる。\nもし明示的に空行を挿入したい場合、 ",
    [
      "#code \\n\\n"
    ],
    " などと書く。"
  ],
  [
    "#h4 文法"
  ],
  [
    "#table\n  ",
    [
      "#tr\n    ",
      [
        "#td ",
        [
          "#em anne"
        ]
      ],
      " ",
      [
        "#td ::="
      ],
      " ",
      [
        "#td ",
        [
          "#em exps"
        ]
      ]
    ],
    "\n  ",
    [
      "#tr\n    ",
      [
        "#td ",
        [
          "#em exp"
        ]
      ],
      " ",
      [
        "#td ::="
      ],
      " ",
      [
        "#td ",
        [
          "#b STRING"
        ]
      ]
    ],
    "\n  ",
    [
      "#tr\n    ",
      [
        "#td ",
        [
          "       "
        ]
      ],
      " ",
      [
        "#td   |"
      ],
      " ",
      [
        "#td ",
        [
          "#code ["
        ],
        " ",
        [
          "#em exps"
        ],
        " ",
        [
          "#code ]"
        ]
      ]
    ],
    "\n  ",
    [
      "#tr\n    ",
      [
        "#td ",
        [
          "#em exps"
        ]
      ],
      " ",
      [
        "#td ::="
      ],
      " ",
      [
        "#td "
      ]
    ],
    "\n  ",
    [
      "#tr\n    ",
      [
        "#td ",
        [
          "        "
        ]
      ],
      " ",
      [
        "#td   |"
      ],
      " ",
      [
        "#td ",
        [
          "#em exp"
        ],
        " ",
        [
          "#em exps"
        ]
      ]
    ]
  ],
`

というような JSON に変換される。

つまり単なる文字列の木になるので、これをお好きな言語でお好きなように処理して使う。

この文書は Anne で [#code #tag] というふうにしてタグを書くという規約を設けて、
それを HTML に変換している。
