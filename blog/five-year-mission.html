<!DOCTYPE html>
<html>
<head>
<title>5年の歳月</title>
<!-- 2018-08-31 Fri 21:41 -->
<meta  charset="utf-8">
<meta  name="generator" content="Org-mode">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css" href="/css/prelude.css" />
<link rel="stylesheet" type="text/css" href="/css/highlight.css" />
</head>
<body>
<div id="content">
<h1 class="title">5年の歳月</h1>
<div class="location">
<p>
https://<a href="/">bydriv.github.io</a>/<a href="/blog">blog</a>/<strong>five-year-mission.html</strong>
</p>

</div>

<div class="created_at">
<p>
created at <time datetime="2018-08-31">2018-08-31</time>
</p>

</div>

<div class="updated_at">
<p>
updated at <time datetime="2018-08-31">2018-08-31</time>
</p>

</div>

<p>
時の流れは速い．わたしは 5年前，友人とある言語処理系を開発していた．
お互いにまだ 10代だった．
</p>

<p>
当時わたしは， 言語自体をユーザが自由に拡張できるマクロという機能に魅せられていた．
だからその言語も基本的な機能は最小限にして， ほとんどの機能をマクロだけで実装した．
評価戦略は遅延評価で， Krivine Machine という VM で実行するものだった．
if 関数や無限リストが動作したときには， いたく感動したものだ．
実装は Haskell でおこなった． 型システムは， いわゆる動的型つけだった．
</p>

<p>
奇しくもまた， Krivine Machine をベースとした <a href="https://github.com/wejournal/lamb">Lamb</a> という処理系を開発している．
当時と異なるのは， マクロよりも静的型システムを重視するようになったこと，
VM 実行ではなくコンパイルするようになったこと， だろうか．
</p>

<p>
5年の時を隔てて， 同じことをしているなあという気もする．
でも理解度は違うと思う． 正直， 当時は VM を実装することはできても，
説明することはできなかった． いまなら説明できると思う．
実装も早く， 正確にできるようになった．
5年勉強したことを発揮している感じがする．
</p>

<p>
5年まえ， わたしは言語処理系の実装はそれで最後にするつもりだった．
なぜそう思ったか． 現実逃避にすぎないと思っていたから．
当時は夏休みなどの時間を使って開発していた．
当時の最終目標はコンパイラの開発だった，気がする．
といっても， 正直よく覚えていない．
確かなのは， コンパイラを開発するために x86 や LLVM の勉強をしていたことだ．
つまりただインタプリタ実行するだけでなく，
コンパイルして使える言語を実装したかった．
もし， 20歳になってもそれが実現できなかったら，
もう言語処理系の才能はないと考えて， 諦めるつもりだった．
</p>

<p>
いま思うと，もし 20歳でそれができるならそれに越したことはないけれど，
諦めるには早すぎるんじゃないかな， とアドバイスしたくなる．
</p>

<p>
ともかく， それが 5年まえのことである．
そして 5年の歳月を経て，いま実際に，
コンパイルして使える言語が実装できてしまった．
</p>

<p>
5年間なにをしていたのか．仕事もしていたし，勉強もしていた．
じゃあ， もっと早く，たとえば 2年前に Lamb は実装できなかったのか？
可能だったかもしれない． でも， たぶんわたしはやらなかっただろう．
理由はふたつ．仕事をしていたこと．やる動機がなかったこと．
</p>

<p>
やる動機はあるじゃないか．
言語処理系を実装したかったんでしょ？
そのきもちがうそじゃない， という自信はない．
もしほんとにやりたいならやっているはずだ，という言葉をうのみにすれば，
わたしはほんとは，とくにやりたくはなかったのだろう．
</p>

<p>
わたしのやりたいというきもちは，たぶん半分は真で，半分は偽．
すくなくとも， なにかきっかけがなければ実装しようと思わなかったと思う．
同人誌を書きたい， というのはそのきっかけとしてじゅうぶんなことだった．
加えていえば， それをだす日程が明確に決まっていたことで，
いまやらなければいつやるんだ， という感じになったのだと思う．
</p>

<p>
Lamb を実装するのに必要な知識は， といえば，
5年前のわたしには， すくなくとも型システムの知識はなかった．
それは 5年間， ちまちまと勉強したことで身についたことである．
ところがその勉強のために 5年必要だったかというと， そうでもないだろう．
すくなくとも 4年まえには， すでに型推論の実装に手をつけていた痕跡がある．
そもそも型推論を積んだ altJS もそのころ実装していた．
だから 4年前の時点ですでに， 現在の Lamb 程度の処理系を実装する能力はあったと思う．
</p>

<p>
といっても， やはり前述したように， 他人に説明できるほど理解していたわけではなかった．
それと，この 5年間でより発展的な型システムやアーキテクチャの知識もついた．
Lamb には実装していないが， いずれ実装してみたい知識が山ほどある．
そのような知識に支えられて， より基礎的な部分の知識が定着した感じである．
</p>

<p>
Lamb の実装を始めたのはこの記事を書いているちょうど2ヶ月まえのことである．
ぽっと出の言語に思えるかもしれないが，実際のところ，
5年，いや，それ以上のあいだ勉強をつづけた成果と考えることもできる．
型推論， 遅延評価，コード生成， GC， FFI， 分割コンパイルと， それなりに実装が難しい機能が揃っている．
言語仕様はあまり大きくないはずだが，
まったくの門外漢がちょっと入門書を読んだ程度では実装できないと思う．
FFI があるので， やろうと思えばゲームを開発することも可能である．
時間的に厳しいのではあるが，やりたいと思っていることのひとつである．
</p>

<p>
Lamb の言語仕様を小さく保とうと思ったのは，
本のサンプルコードも兼ねているため実装を大きくしたくないと言うのと，
あまり本質的でない言語機能に時間を割かず，
より本質的と思われる言語機能に集中したかったからである．
言語仕様はそれなりにコンパクトだが， Esolang というわけでもない．
チャーチ数の代わりに FFI で 64 ビット整数などを使うようにすれば，
それなりに実用的なプログラムも書けるはずである．
</p>

<p>
Lamb の話なのかわたしの話なのか．
ともかく， これまでの背景を述べたものでした．
おしまい．
</p>
</div>
</body>
</html>
