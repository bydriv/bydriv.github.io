<!DOCTYPE html>
<html>
<head>
<title>Data.RBMap.hs</title>
<!-- 2018-01-16 Tue 16:56 -->
<meta  charset="utf-8">
<meta  name="generator" content="Org-mode">
<link rel="stylesheet" type="text/css" href="/css/prelude.css" />
<link rel="stylesheet" type="text/css" href="/css/highlight.css" />
</head>
<body>
<div id="content">
<h1 class="title">Data.RBMap.hs</h1>
<div class="location">
<p>
https://<a href="/">bydriv.github.io</a>/<a href="/Data">Data</a>/<strong>RBMap.html</strong>
</p>

</div>

<div class="created_at">
<p>
created at <time datetime="2018-01-15">2018-01-15</time>
</p>

</div>

<div class="updated_at">
<p>
updated at <time datetime="2018-01-16">2018-01-16</time>
</p>

</div>

<p>
データ構造の勉強のために赤黒木を実装してみた．
すでに大勢の人々が同様のことをしているので公開する意味はあまりないかもしれないが，
勉強メモは残しておくとなにかと便利なことが多いので， いちおう GPLv3 で配布しておく．
</p>

<div class="highlight"><pre><span class="c1">-- Data.RBMap.hs © 2018 Kaoru Kawamukai &lt;bydriv@gmail.com&gt;</span>
<span class="c1">--</span>
<span class="c1">-- Data.RBMap.hs is free software: you can redistribute it and/or modify</span>
<span class="c1">-- it under the terms of the GNU General Public License as published by</span>
<span class="c1">-- the Free Software Foundation, either version 3 of the License, or</span>
<span class="c1">-- (at your option) any later version.</span>
<span class="c1">--</span>
<span class="c1">-- Data.RBMap.hs is distributed in the hope that it will be useful,</span>
<span class="c1">-- but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1">-- MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1">-- GNU General Public License for more details.</span>
<span class="c1">--</span>
<span class="c1">-- You should have received a copy of the GNU General Public License</span>
<span class="c1">-- along with Data.RBMap.hs.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>

<span class="kr">module</span> <span class="nn">Data.RBMap</span>
  <span class="p">(</span> <span class="kt">RBMap</span>
  <span class="p">,</span> <span class="nf">empty</span>
  <span class="p">,</span> <span class="nf">singleton</span>
  <span class="p">,</span> <span class="nf">foldri</span>
  <span class="p">,</span> <span class="nf">foldr</span>
  <span class="p">,</span> <span class="nf">foldli</span>
  <span class="p">,</span> <span class="nf">foldl</span>
  <span class="p">,</span> <span class="nf">foldiTree</span>
  <span class="p">,</span> <span class="nf">foldTree</span>
  <span class="p">,</span> <span class="nf">mapi</span>
  <span class="p">,</span> <span class="nf">map</span>
  <span class="p">,</span> <span class="nf">gmap</span>
  <span class="p">,</span> <span class="nf">filteri</span>
  <span class="p">,</span> <span class="nf">filter</span>
  <span class="p">,</span> <span class="nf">alli</span>
  <span class="p">,</span> <span class="nf">all</span>
  <span class="p">,</span> <span class="nf">anyi</span>
  <span class="p">,</span> <span class="nf">any</span>
  <span class="p">,</span> <span class="nf">lookup</span>
  <span class="p">,</span> <span class="nf">insert</span>
  <span class="p">,</span> <span class="nf">delete</span>
  <span class="p">,</span> <span class="nf">null</span>
  <span class="p">,</span> <span class="nf">member</span>
  <span class="p">,</span> <span class="nf">insertBy</span>
  <span class="p">,</span> <span class="nf">alter</span>
  <span class="p">,</span> <span class="nf">update</span>
  <span class="p">,</span> <span class="nf">adjust</span>
  <span class="p">,</span> <span class="nf">unionBy</span>
  <span class="p">,</span> <span class="nf">unionsBy</span>
  <span class="p">,</span> <span class="nf">unionl</span>
  <span class="p">,</span> <span class="nf">unionr</span>
  <span class="p">,</span> <span class="nf">interBy</span>
  <span class="p">,</span> <span class="nf">interl</span>
  <span class="p">,</span> <span class="nf">interr</span>
  <span class="p">,</span> <span class="nf">diffBy</span>
  <span class="p">,</span> <span class="nf">diff</span>
  <span class="p">,</span> <span class="nf">keys</span>
  <span class="p">,</span> <span class="nf">elts</span>
  <span class="p">,</span> <span class="nf">maximumKey</span>
  <span class="p">,</span> <span class="nf">minimumKey</span>
  <span class="p">,</span> <span class="nf">maximum</span>
  <span class="p">,</span> <span class="nf">minimum</span>
  <span class="p">,</span> <span class="nf">toList</span>
  <span class="p">,</span> <span class="nf">fromList</span> <span class="p">)</span> <span class="kr">where</span>

<span class="kr">import</span>           <span class="nn">Prelude</span>
  <span class="k">hiding</span>
    <span class="p">(</span> <span class="nf">all</span>
    <span class="p">,</span> <span class="nf">any</span>
    <span class="p">,</span> <span class="nf">filter</span>
    <span class="p">,</span> <span class="nf">foldl</span>
    <span class="p">,</span> <span class="nf">foldr</span>
    <span class="p">,</span> <span class="nf">lookup</span>
    <span class="p">,</span> <span class="nf">map</span>
    <span class="p">,</span> <span class="nf">maximum</span>
    <span class="p">,</span> <span class="nf">minimum</span>
    <span class="p">,</span> <span class="nf">null</span> <span class="p">)</span>
<span class="kr">import</span> <span class="k">qualified</span> <span class="nn">Prelude</span>
<span class="kr">import</span> <span class="k">qualified</span> <span class="nn">Data.List</span>  <span class="k">as</span> <span class="n">List</span>
<span class="kr">import</span> <span class="k">qualified</span> <span class="nn">Data.Maybe</span> <span class="k">as</span> <span class="n">Maybe</span>

<span class="kr">data</span> <span class="kt">Color</span> <span class="ow">=</span>
    <span class="kt">Red</span>
  <span class="o">|</span> <span class="kt">Black</span>
  <span class="kr">deriving</span> <span class="p">(</span><span class="kt">Eq</span><span class="p">,</span> <span class="kt">Ord</span><span class="p">,</span> <span class="kt">Read</span><span class="p">,</span> <span class="kt">Show</span><span class="p">)</span>

<span class="kr">data</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span> <span class="ow">=</span>
    <span class="kt">Empty</span>
  <span class="o">|</span> <span class="kt">Node</span> <span class="kt">Color</span> <span class="p">(</span><span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span><span class="p">)</span> <span class="p">(</span><span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span><span class="p">)</span> <span class="n">k</span> <span class="n">a</span>

<span class="kr">instance</span> <span class="p">(</span><span class="kt">Eq</span> <span class="n">k</span><span class="p">,</span> <span class="kt">Eq</span> <span class="n">a</span><span class="p">)</span> <span class="ow">=&gt;</span> <span class="kt">Eq</span> <span class="p">(</span><span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span><span class="p">)</span> <span class="kr">where</span>
  <span class="n">lhs</span> <span class="o">==</span> <span class="n">rhs</span> <span class="ow">=</span> <span class="n">toList</span> <span class="n">lhs</span> <span class="o">==</span> <span class="n">toList</span> <span class="n">rhs</span>

<span class="kr">instance</span> <span class="p">(</span><span class="kt">Ord</span> <span class="n">k</span><span class="p">,</span> <span class="kt">Ord</span> <span class="n">a</span><span class="p">)</span> <span class="ow">=&gt;</span> <span class="kt">Ord</span> <span class="p">(</span><span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span><span class="p">)</span> <span class="kr">where</span>
  <span class="n">compare</span> <span class="n">lhs</span> <span class="n">rhs</span> <span class="ow">=</span> <span class="n">compare</span> <span class="p">(</span><span class="n">toList</span> <span class="n">lhs</span><span class="p">)</span> <span class="p">(</span><span class="n">toList</span> <span class="n">rhs</span><span class="p">)</span>

<span class="kr">instance</span> <span class="p">(</span><span class="kt">Ord</span> <span class="n">k</span><span class="p">,</span> <span class="kt">Read</span> <span class="n">k</span><span class="p">,</span> <span class="kt">Read</span> <span class="n">a</span><span class="p">)</span> <span class="ow">=&gt;</span> <span class="kt">Read</span> <span class="p">(</span><span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span><span class="p">)</span> <span class="kr">where</span>
  <span class="n">readsPrec</span> <span class="kr">_</span> <span class="n">s</span> <span class="ow">=</span>
    <span class="kr">if</span> <span class="kt">List</span><span class="o">.</span><span class="n">isPrefixOf</span> <span class="s">&quot;fromList&quot;</span> <span class="n">s</span> <span class="kr">then</span>
      <span class="kt">List</span><span class="o">.</span><span class="n">map</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">alist</span><span class="p">,</span> <span class="n">s&#39;</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">fromList</span> <span class="n">alist</span><span class="p">,</span> <span class="n">s&#39;</span><span class="p">))</span> <span class="o">$</span> <span class="n">reads</span> <span class="o">$</span> <span class="kt">List</span><span class="o">.</span><span class="n">drop</span> <span class="mi">8</span> <span class="n">s</span>
    <span class="kr">else</span>
      <span class="kt">[]</span>

<span class="kr">instance</span> <span class="p">(</span><span class="kt">Show</span> <span class="n">k</span><span class="p">,</span> <span class="kt">Show</span> <span class="n">a</span><span class="p">)</span> <span class="ow">=&gt;</span> <span class="kt">Show</span> <span class="p">(</span><span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span><span class="p">)</span> <span class="kr">where</span>
  <span class="n">show</span> <span class="ow">=</span> <span class="p">(</span><span class="s">&quot;fromList&quot;</span> <span class="o">++</span><span class="p">)</span> <span class="o">.</span> <span class="n">show</span> <span class="o">.</span> <span class="n">toList</span>

<span class="nf">toRed</span> <span class="ow">::</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span>
<span class="nf">toRed</span> <span class="kt">Empty</span> <span class="ow">=</span> <span class="kt">Empty</span>
<span class="nf">toRed</span> <span class="p">(</span><span class="kt">Node</span> <span class="kr">_</span> <span class="n">l</span> <span class="n">r</span> <span class="n">k</span> <span class="n">x</span><span class="p">)</span> <span class="ow">=</span> <span class="kt">Node</span> <span class="kt">Red</span> <span class="n">l</span> <span class="n">r</span> <span class="n">k</span> <span class="n">x</span>

<span class="nf">toBlack</span> <span class="ow">::</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span>
<span class="nf">toBlack</span> <span class="kt">Empty</span> <span class="ow">=</span> <span class="kt">Empty</span>
<span class="nf">toBlack</span> <span class="p">(</span><span class="kt">Node</span> <span class="kr">_</span> <span class="n">l</span> <span class="n">r</span> <span class="n">k</span> <span class="n">x</span><span class="p">)</span> <span class="ow">=</span> <span class="kt">Node</span> <span class="kt">Black</span> <span class="n">l</span> <span class="n">r</span> <span class="n">k</span> <span class="n">x</span>

<span class="nf">balance</span> <span class="ow">::</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span>
<span class="nf">balance</span> <span class="p">(</span><span class="kt">Node</span> <span class="kt">Black</span> <span class="p">(</span><span class="kt">Node</span> <span class="kt">Red</span> <span class="p">(</span><span class="kt">Node</span> <span class="kt">Red</span> <span class="n">l2</span> <span class="n">r2</span> <span class="n">k2</span> <span class="n">x2</span><span class="p">)</span> <span class="n">r1</span> <span class="n">k1</span> <span class="n">x1</span><span class="p">)</span> <span class="n">r0</span> <span class="n">k0</span> <span class="n">x0</span><span class="p">)</span> <span class="ow">=</span>
  <span class="kt">Node</span> <span class="kt">Red</span> <span class="p">(</span><span class="kt">Node</span> <span class="kt">Black</span> <span class="n">l2</span> <span class="n">r2</span> <span class="n">k2</span> <span class="n">x2</span><span class="p">)</span> <span class="p">(</span><span class="kt">Node</span> <span class="kt">Black</span> <span class="n">r1</span> <span class="n">r0</span> <span class="n">k0</span> <span class="n">x0</span><span class="p">)</span> <span class="n">k1</span> <span class="n">x1</span>
<span class="nf">balance</span> <span class="p">(</span><span class="kt">Node</span> <span class="kt">Black</span> <span class="p">(</span><span class="kt">Node</span> <span class="kt">Red</span> <span class="n">l1</span> <span class="p">(</span><span class="kt">Node</span> <span class="kt">Red</span> <span class="n">l2</span> <span class="n">r2</span> <span class="n">k2</span> <span class="n">x2</span><span class="p">)</span> <span class="n">k1</span> <span class="n">x1</span><span class="p">)</span> <span class="n">r0</span> <span class="n">k0</span> <span class="n">x0</span><span class="p">)</span> <span class="ow">=</span>
  <span class="kt">Node</span> <span class="kt">Red</span> <span class="p">(</span><span class="kt">Node</span> <span class="kt">Black</span> <span class="n">l1</span> <span class="n">l2</span> <span class="n">k1</span> <span class="n">x1</span><span class="p">)</span> <span class="p">(</span><span class="kt">Node</span> <span class="kt">Black</span> <span class="n">r2</span> <span class="n">r0</span> <span class="n">k0</span> <span class="n">x0</span><span class="p">)</span> <span class="n">k2</span> <span class="n">x2</span>
<span class="nf">balance</span> <span class="p">(</span><span class="kt">Node</span> <span class="kt">Black</span> <span class="n">l0</span> <span class="p">(</span><span class="kt">Node</span> <span class="kt">Red</span> <span class="p">(</span><span class="kt">Node</span> <span class="kt">Red</span> <span class="n">l2</span> <span class="n">r2</span> <span class="n">k2</span> <span class="n">x2</span><span class="p">)</span> <span class="n">r1</span> <span class="n">k1</span> <span class="n">x1</span><span class="p">)</span> <span class="n">k0</span> <span class="n">x0</span><span class="p">)</span> <span class="ow">=</span>
  <span class="kt">Node</span> <span class="kt">Red</span> <span class="p">(</span><span class="kt">Node</span> <span class="kt">Black</span> <span class="n">l0</span> <span class="n">l2</span> <span class="n">k0</span> <span class="n">x0</span><span class="p">)</span> <span class="p">(</span><span class="kt">Node</span> <span class="kt">Black</span> <span class="n">r2</span> <span class="n">r1</span> <span class="n">k1</span> <span class="n">x1</span><span class="p">)</span> <span class="n">k2</span> <span class="n">x2</span>
<span class="nf">balance</span> <span class="p">(</span><span class="kt">Node</span> <span class="kt">Black</span> <span class="n">l0</span> <span class="p">(</span><span class="kt">Node</span> <span class="kt">Red</span> <span class="n">l1</span> <span class="p">(</span><span class="kt">Node</span> <span class="kt">Red</span> <span class="n">l2</span> <span class="n">r2</span> <span class="n">k2</span> <span class="n">x2</span><span class="p">)</span> <span class="n">k1</span> <span class="n">x1</span><span class="p">)</span> <span class="n">k0</span> <span class="n">x0</span><span class="p">)</span> <span class="ow">=</span>
  <span class="kt">Node</span> <span class="kt">Red</span> <span class="p">(</span><span class="kt">Node</span> <span class="kt">Black</span> <span class="n">l0</span> <span class="n">l1</span> <span class="n">k0</span> <span class="n">x0</span><span class="p">)</span> <span class="p">(</span><span class="kt">Node</span> <span class="kt">Black</span> <span class="n">l2</span> <span class="n">r2</span> <span class="n">k2</span> <span class="n">x2</span><span class="p">)</span> <span class="n">k1</span> <span class="n">x1</span>
<span class="nf">balance</span> <span class="n">rbMap</span> <span class="ow">=</span>
  <span class="n">rbMap</span>

<span class="nf">empty</span> <span class="ow">::</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span>
<span class="nf">empty</span> <span class="ow">=</span> <span class="kt">Empty</span>

<span class="nf">singleton</span> <span class="ow">::</span> <span class="n">k</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span>
<span class="nf">singleton</span> <span class="ow">=</span> <span class="kt">Node</span> <span class="kt">Black</span> <span class="kt">Empty</span> <span class="kt">Empty</span>

<span class="nf">foldri</span> <span class="ow">::</span> <span class="p">(</span><span class="n">k</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">b</span> <span class="ow">-&gt;</span> <span class="n">b</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">b</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">b</span>
<span class="nf">foldri</span> <span class="kr">_</span> <span class="n">z</span> <span class="kt">Empty</span> <span class="ow">=</span> <span class="n">z</span>
<span class="nf">foldri</span> <span class="n">f</span> <span class="n">z</span> <span class="p">(</span><span class="kt">Node</span> <span class="kr">_</span> <span class="n">l</span> <span class="n">r</span> <span class="n">k</span> <span class="n">x</span><span class="p">)</span> <span class="ow">=</span> <span class="n">foldri</span> <span class="n">f</span> <span class="p">(</span><span class="n">f</span> <span class="n">k</span> <span class="n">x</span> <span class="p">(</span><span class="n">foldri</span> <span class="n">f</span> <span class="n">z</span> <span class="n">r</span><span class="p">))</span> <span class="n">l</span>

<span class="nf">foldr</span> <span class="ow">::</span> <span class="p">(</span><span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">b</span> <span class="ow">-&gt;</span> <span class="n">b</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">b</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">b</span>
<span class="nf">foldr</span> <span class="ow">=</span> <span class="n">foldri</span> <span class="o">.</span> <span class="n">const</span>

<span class="nf">foldli</span> <span class="ow">::</span> <span class="p">(</span><span class="n">k</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">b</span> <span class="ow">-&gt;</span> <span class="n">b</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">b</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">b</span>
<span class="nf">foldli</span> <span class="kr">_</span> <span class="n">z</span> <span class="kt">Empty</span> <span class="ow">=</span> <span class="n">z</span>
<span class="nf">foldli</span> <span class="n">f</span> <span class="n">z</span> <span class="p">(</span><span class="kt">Node</span> <span class="kr">_</span> <span class="n">l</span> <span class="n">r</span> <span class="n">k</span> <span class="n">x</span><span class="p">)</span> <span class="ow">=</span> <span class="n">foldli</span> <span class="n">f</span> <span class="p">(</span><span class="n">f</span> <span class="n">k</span> <span class="n">x</span> <span class="p">(</span><span class="n">foldli</span> <span class="n">f</span> <span class="n">z</span> <span class="n">l</span><span class="p">))</span> <span class="n">r</span>

<span class="nf">foldl</span> <span class="ow">::</span> <span class="p">(</span><span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">b</span> <span class="ow">-&gt;</span> <span class="n">b</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">b</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">b</span>
<span class="nf">foldl</span> <span class="ow">=</span> <span class="n">foldli</span> <span class="o">.</span> <span class="n">const</span>

<span class="nf">foldiTree</span> <span class="ow">::</span> <span class="p">(</span><span class="n">k</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">b</span> <span class="ow">-&gt;</span> <span class="n">b</span> <span class="ow">-&gt;</span> <span class="n">b</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">b</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">b</span>
<span class="nf">foldiTree</span> <span class="kr">_</span> <span class="n">z</span> <span class="kt">Empty</span> <span class="ow">=</span> <span class="n">z</span>
<span class="nf">foldiTree</span> <span class="n">f</span> <span class="n">z</span> <span class="p">(</span><span class="kt">Node</span> <span class="kr">_</span> <span class="n">l</span> <span class="n">r</span> <span class="n">k</span> <span class="n">x</span><span class="p">)</span> <span class="ow">=</span> <span class="n">f</span> <span class="n">k</span> <span class="n">x</span> <span class="p">(</span><span class="n">foldiTree</span> <span class="n">f</span> <span class="n">z</span> <span class="n">l</span><span class="p">)</span> <span class="p">(</span><span class="n">foldiTree</span> <span class="n">f</span> <span class="n">z</span> <span class="n">r</span><span class="p">)</span>

<span class="nf">foldTree</span> <span class="ow">::</span> <span class="p">(</span><span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">b</span> <span class="ow">-&gt;</span> <span class="n">b</span> <span class="ow">-&gt;</span> <span class="n">b</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">b</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">b</span>
<span class="nf">foldTree</span> <span class="ow">=</span> <span class="n">foldiTree</span> <span class="o">.</span> <span class="n">const</span>

<span class="nf">mapi</span> <span class="ow">::</span> <span class="p">(</span><span class="n">k</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">b</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">b</span>
<span class="nf">mapi</span> <span class="kr">_</span> <span class="kt">Empty</span> <span class="ow">=</span> <span class="kt">Empty</span>
<span class="nf">mapi</span> <span class="n">f</span> <span class="p">(</span><span class="kt">Node</span> <span class="n">color</span> <span class="n">l</span> <span class="n">r</span> <span class="n">k</span> <span class="n">x</span><span class="p">)</span> <span class="ow">=</span> <span class="kt">Node</span> <span class="n">color</span> <span class="p">(</span><span class="n">mapi</span> <span class="n">f</span> <span class="n">l</span><span class="p">)</span> <span class="p">(</span><span class="n">mapi</span> <span class="n">f</span> <span class="n">r</span><span class="p">)</span> <span class="n">k</span> <span class="p">(</span><span class="n">f</span> <span class="n">k</span> <span class="n">x</span><span class="p">)</span>

<span class="nf">map</span> <span class="ow">::</span> <span class="p">(</span><span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">b</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">b</span>
<span class="nf">map</span> <span class="ow">=</span> <span class="n">mapi</span> <span class="o">.</span> <span class="n">const</span>

<span class="nf">gmap</span> <span class="ow">::</span> <span class="p">(</span><span class="kt">Ord</span> <span class="n">k</span><span class="p">,</span> <span class="kt">Ord</span> <span class="n">k&#39;</span><span class="p">)</span> <span class="ow">=&gt;</span> <span class="p">(</span><span class="n">k</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">k&#39;</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k&#39;</span> <span class="n">b</span>
<span class="nf">gmap</span> <span class="n">f</span> <span class="ow">=</span> <span class="n">foldri</span> <span class="p">(</span><span class="nf">\</span><span class="n">k</span> <span class="ow">-&gt;</span> <span class="n">uncurry</span> <span class="n">insert</span> <span class="o">.</span> <span class="n">f</span> <span class="n">k</span><span class="p">)</span> <span class="n">empty</span>

<span class="nf">filteri</span> <span class="ow">::</span> <span class="kt">Ord</span> <span class="n">k</span> <span class="ow">=&gt;</span> <span class="p">(</span><span class="n">k</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span>
<span class="nf">filteri</span> <span class="n">f</span> <span class="ow">=</span> <span class="n">flip</span> <span class="n">foldri</span> <span class="n">empty</span> <span class="o">$</span> <span class="nf">\</span><span class="n">k</span> <span class="n">x</span> <span class="ow">-&gt;</span>
  <span class="kr">if</span> <span class="n">f</span> <span class="n">k</span> <span class="n">x</span> <span class="kr">then</span>
    <span class="n">insert</span> <span class="n">k</span> <span class="n">x</span>
  <span class="kr">else</span>
    <span class="n">id</span>

<span class="nf">filter</span> <span class="ow">::</span> <span class="kt">Ord</span> <span class="n">k</span> <span class="ow">=&gt;</span> <span class="p">(</span><span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span>
<span class="nf">filter</span> <span class="ow">=</span> <span class="n">filteri</span> <span class="o">.</span> <span class="n">const</span>

<span class="nf">alli</span> <span class="ow">::</span> <span class="p">(</span><span class="n">k</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span>
<span class="nf">alli</span> <span class="n">f</span> <span class="ow">=</span> <span class="n">foldri</span> <span class="p">(</span><span class="nf">\</span><span class="n">k</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="o">&amp;&amp;</span><span class="p">)</span> <span class="o">.</span> <span class="p">(</span><span class="n">f</span> <span class="n">k</span><span class="p">))</span> <span class="kt">True</span>

<span class="nf">all</span> <span class="ow">::</span> <span class="p">(</span><span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span>
<span class="nf">all</span> <span class="ow">=</span> <span class="n">alli</span> <span class="o">.</span> <span class="n">const</span>

<span class="nf">anyi</span> <span class="ow">::</span> <span class="p">(</span><span class="n">k</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span>
<span class="nf">anyi</span> <span class="n">f</span> <span class="ow">=</span> <span class="n">foldri</span> <span class="p">(</span><span class="nf">\</span><span class="n">k</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="o">||</span><span class="p">)</span> <span class="o">.</span> <span class="p">(</span><span class="n">f</span> <span class="n">k</span><span class="p">))</span> <span class="kt">False</span>

<span class="nf">any</span> <span class="ow">::</span> <span class="p">(</span><span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span>
<span class="nf">any</span> <span class="ow">=</span> <span class="n">anyi</span> <span class="o">.</span> <span class="n">const</span>

<span class="nf">lookup</span> <span class="ow">::</span> <span class="kt">Ord</span> <span class="n">k</span> <span class="ow">=&gt;</span> <span class="n">k</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Maybe</span> <span class="n">a</span>
<span class="nf">lookup</span> <span class="kr">_</span> <span class="kt">Empty</span> <span class="ow">=</span>
  <span class="kt">Nothing</span>
<span class="nf">lookup</span> <span class="n">k</span> <span class="p">(</span><span class="kt">Node</span> <span class="kr">_</span> <span class="n">l0</span> <span class="n">r0</span> <span class="n">k0</span> <span class="n">x0</span><span class="p">)</span> <span class="ow">=</span>
  <span class="kr">case</span> <span class="n">compare</span> <span class="n">k</span> <span class="n">k0</span> <span class="kr">of</span>
    <span class="kt">LT</span> <span class="ow">-&gt;</span> <span class="n">lookup</span> <span class="n">k</span> <span class="n">l0</span>
    <span class="kt">EQ</span> <span class="ow">-&gt;</span> <span class="kt">Just</span> <span class="n">x0</span>
    <span class="kt">GT</span> <span class="ow">-&gt;</span> <span class="n">lookup</span> <span class="n">k</span> <span class="n">r0</span>

<span class="nf">insert</span> <span class="ow">::</span> <span class="kt">Ord</span> <span class="n">k</span> <span class="ow">=&gt;</span> <span class="n">k</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span>
<span class="nf">insert</span> <span class="n">k</span> <span class="n">x</span> <span class="ow">=</span> <span class="n">toBlack</span> <span class="o">.</span> <span class="n">insert&#39;</span> <span class="kr">where</span>
  <span class="n">insert&#39;</span> <span class="kt">Empty</span> <span class="ow">=</span>
    <span class="kt">Node</span> <span class="kt">Red</span> <span class="kt">Empty</span> <span class="kt">Empty</span> <span class="n">k</span> <span class="n">x</span>
  <span class="n">insert&#39;</span> <span class="p">(</span><span class="kt">Node</span> <span class="n">color</span> <span class="n">l0</span> <span class="n">r0</span> <span class="n">k0</span> <span class="n">x0</span><span class="p">)</span> <span class="ow">=</span>
    <span class="kr">case</span> <span class="n">compare</span> <span class="n">k</span> <span class="n">k0</span> <span class="kr">of</span>
      <span class="kt">LT</span> <span class="ow">-&gt;</span> <span class="n">balance</span> <span class="o">$</span> <span class="kt">Node</span> <span class="n">color</span> <span class="p">(</span><span class="n">insert&#39;</span> <span class="n">l0</span><span class="p">)</span> <span class="n">r0</span> <span class="n">k0</span> <span class="n">x0</span>
      <span class="kt">EQ</span> <span class="ow">-&gt;</span> <span class="kt">Node</span> <span class="n">color</span> <span class="n">l0</span> <span class="n">r0</span> <span class="n">k</span> <span class="n">x</span>
      <span class="kt">GT</span> <span class="ow">-&gt;</span> <span class="n">balance</span> <span class="o">$</span> <span class="kt">Node</span> <span class="n">color</span> <span class="n">l0</span> <span class="p">(</span><span class="n">insert&#39;</span> <span class="n">r0</span><span class="p">)</span> <span class="n">k0</span> <span class="n">x0</span>

<span class="nf">delete</span> <span class="ow">::</span> <span class="kt">Ord</span> <span class="n">k</span> <span class="ow">=&gt;</span> <span class="n">k</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span>
<span class="nf">delete</span> <span class="n">k</span> <span class="ow">=</span> <span class="n">toBlack</span> <span class="o">.</span> <span class="n">delete&#39;</span> <span class="kr">where</span>
  <span class="n">cat</span> <span class="kt">Empty</span> <span class="n">r0</span> <span class="ow">=</span>
    <span class="n">r0</span>
  <span class="n">cat</span> <span class="n">l0</span> <span class="kt">Empty</span> <span class="ow">=</span>
    <span class="n">l0</span>
  <span class="n">cat</span> <span class="p">(</span><span class="kt">Node</span> <span class="kt">Red</span> <span class="n">l1</span> <span class="n">r1</span> <span class="n">k1</span> <span class="n">x1</span><span class="p">)</span> <span class="p">(</span><span class="kt">Node</span> <span class="kt">Red</span> <span class="n">l2</span> <span class="n">r2</span> <span class="n">k2</span> <span class="n">x2</span><span class="p">)</span> <span class="ow">=</span>
    <span class="kr">case</span> <span class="n">cat</span> <span class="n">r1</span> <span class="n">l2</span> <span class="kr">of</span>
      <span class="kt">Node</span> <span class="kt">Red</span> <span class="n">l3</span> <span class="n">r3</span> <span class="n">k3</span> <span class="n">x3</span> <span class="ow">-&gt;</span>
        <span class="kt">Node</span> <span class="kt">Red</span> <span class="p">(</span><span class="kt">Node</span> <span class="kt">Red</span> <span class="n">l1</span> <span class="n">l3</span> <span class="n">k1</span> <span class="n">x1</span><span class="p">)</span> <span class="p">(</span><span class="kt">Node</span> <span class="kt">Red</span> <span class="n">r3</span> <span class="n">r2</span> <span class="n">k2</span> <span class="n">x2</span><span class="p">)</span> <span class="n">k3</span> <span class="n">x3</span>
      <span class="n">rbMap</span> <span class="ow">-&gt;</span>
        <span class="kt">Node</span> <span class="kt">Red</span> <span class="n">l1</span> <span class="p">(</span><span class="kt">Node</span> <span class="kt">Red</span> <span class="n">rbMap</span> <span class="n">r2</span> <span class="n">k2</span> <span class="n">x2</span><span class="p">)</span> <span class="n">k1</span> <span class="n">x1</span>
  <span class="n">cat</span> <span class="p">(</span><span class="kt">Node</span> <span class="kt">Black</span> <span class="n">l1</span> <span class="n">r1</span> <span class="n">k1</span> <span class="n">x1</span><span class="p">)</span> <span class="p">(</span><span class="kt">Node</span> <span class="kt">Black</span> <span class="n">l2</span> <span class="n">r2</span> <span class="n">k2</span> <span class="n">x2</span><span class="p">)</span> <span class="ow">=</span>
    <span class="kr">case</span> <span class="n">cat</span> <span class="n">r1</span> <span class="n">l2</span> <span class="kr">of</span>
      <span class="kt">Node</span> <span class="kt">Red</span> <span class="n">l3</span> <span class="n">r3</span> <span class="n">k3</span> <span class="n">x3</span> <span class="ow">-&gt;</span>
        <span class="kt">Node</span> <span class="kt">Red</span> <span class="p">(</span><span class="kt">Node</span> <span class="kt">Black</span> <span class="n">l1</span> <span class="n">l3</span> <span class="n">k1</span> <span class="n">x1</span><span class="p">)</span> <span class="p">(</span><span class="kt">Node</span> <span class="kt">Black</span> <span class="n">r3</span> <span class="n">r2</span> <span class="n">k2</span> <span class="n">x2</span><span class="p">)</span> <span class="n">k3</span> <span class="n">x3</span>
      <span class="n">rbMap</span> <span class="ow">-&gt;</span>
        <span class="kr">case</span> <span class="n">l1</span> <span class="kr">of</span>
          <span class="kt">Node</span> <span class="kt">Red</span> <span class="n">l4</span> <span class="n">r4</span> <span class="n">k4</span> <span class="n">x4</span> <span class="ow">-&gt;</span>
            <span class="kt">Node</span> <span class="kt">Red</span> <span class="p">(</span><span class="kt">Node</span> <span class="kt">Black</span> <span class="n">l4</span> <span class="n">r4</span> <span class="n">k4</span> <span class="n">x4</span><span class="p">)</span> <span class="p">(</span><span class="kt">Node</span> <span class="kt">Black</span> <span class="n">rbMap</span> <span class="n">r2</span> <span class="n">k2</span> <span class="n">x2</span><span class="p">)</span> <span class="n">k1</span> <span class="n">x1</span>
          <span class="kr">_</span> <span class="ow">-&gt;</span>
            <span class="n">balance</span> <span class="p">(</span><span class="kt">Node</span> <span class="kt">Black</span> <span class="n">l1</span> <span class="p">(</span><span class="kt">Node</span> <span class="kt">Red</span> <span class="n">rbMap</span> <span class="n">r2</span> <span class="n">k2</span> <span class="n">x2</span><span class="p">)</span> <span class="n">k1</span> <span class="n">x1</span><span class="p">)</span>
  <span class="n">cat</span> <span class="n">l0</span> <span class="p">(</span><span class="kt">Node</span> <span class="kt">Red</span> <span class="n">l2</span> <span class="n">r2</span> <span class="n">k2</span> <span class="n">x2</span><span class="p">)</span> <span class="ow">=</span>
    <span class="kt">Node</span> <span class="kt">Red</span> <span class="p">(</span><span class="n">cat</span> <span class="n">l0</span> <span class="n">l2</span><span class="p">)</span> <span class="n">r2</span> <span class="n">k2</span> <span class="n">x2</span>
  <span class="n">cat</span> <span class="p">(</span><span class="kt">Node</span> <span class="kt">Red</span> <span class="n">l1</span> <span class="n">r1</span> <span class="n">k1</span> <span class="n">x1</span><span class="p">)</span> <span class="n">r0</span> <span class="ow">=</span>
    <span class="kt">Node</span> <span class="kt">Red</span> <span class="n">l1</span> <span class="p">(</span><span class="n">cat</span> <span class="n">r1</span> <span class="n">r0</span><span class="p">)</span> <span class="n">k1</span> <span class="n">x1</span>

  <span class="n">delete&#39;</span> <span class="kt">Empty</span> <span class="ow">=</span>
    <span class="kt">Empty</span>
  <span class="n">delete&#39;</span> <span class="p">(</span><span class="kt">Node</span> <span class="kr">_</span> <span class="n">l0</span> <span class="n">r0</span> <span class="n">k0</span> <span class="n">x0</span><span class="p">)</span> <span class="ow">=</span>
    <span class="kr">case</span> <span class="n">compare</span> <span class="n">k</span> <span class="n">k0</span> <span class="kr">of</span>
      <span class="kt">LT</span> <span class="ow">-&gt;</span>
        <span class="kr">case</span> <span class="n">l0</span> <span class="kr">of</span>
          <span class="kt">Node</span> <span class="kt">Black</span> <span class="kr">_</span> <span class="kr">_</span> <span class="kr">_</span> <span class="kr">_</span> <span class="ow">-&gt;</span>
            <span class="kr">case</span> <span class="n">delete&#39;</span> <span class="n">l0</span> <span class="kr">of</span>
              <span class="kt">Node</span> <span class="kt">Red</span> <span class="n">l1</span> <span class="n">r1</span> <span class="n">k1</span> <span class="n">x1</span> <span class="ow">-&gt;</span>
                <span class="kt">Node</span> <span class="kt">Red</span> <span class="p">(</span><span class="kt">Node</span> <span class="kt">Black</span> <span class="n">l1</span> <span class="n">r1</span> <span class="n">k1</span> <span class="n">x1</span><span class="p">)</span> <span class="n">r0</span> <span class="n">k0</span> <span class="n">x0</span>
              <span class="n">l0&#39;</span> <span class="ow">-&gt;</span>
                <span class="kr">case</span> <span class="n">r0</span> <span class="kr">of</span>
                  <span class="kt">Node</span> <span class="kt">Black</span> <span class="n">l1</span> <span class="n">r1</span> <span class="n">k1</span> <span class="n">x1</span> <span class="ow">-&gt;</span>
                    <span class="n">balance</span> <span class="p">(</span><span class="kt">Node</span> <span class="kt">Black</span> <span class="n">l0&#39;</span> <span class="p">(</span><span class="kt">Node</span> <span class="kt">Red</span> <span class="n">l1</span> <span class="n">r1</span> <span class="n">k1</span> <span class="n">x1</span><span class="p">)</span> <span class="n">k0</span> <span class="n">x0</span><span class="p">)</span>
                  <span class="kt">Node</span> <span class="kt">Red</span> <span class="p">(</span><span class="kt">Node</span> <span class="kt">Black</span> <span class="n">l2</span> <span class="n">r2</span> <span class="n">k2</span> <span class="n">x2</span><span class="p">)</span> <span class="n">r1</span> <span class="n">k1</span> <span class="n">x1</span> <span class="ow">-&gt;</span>
                    <span class="kt">Node</span>
                      <span class="kt">Red</span>
                      <span class="p">(</span><span class="kt">Node</span> <span class="kt">Black</span> <span class="n">l0&#39;</span> <span class="n">l2</span> <span class="n">k0</span> <span class="n">x0</span><span class="p">)</span>
                      <span class="p">(</span><span class="n">balance</span> <span class="p">(</span><span class="kt">Node</span> <span class="kt">Black</span> <span class="n">r2</span> <span class="p">(</span><span class="n">toRed</span> <span class="n">r1</span><span class="p">)</span> <span class="n">k1</span> <span class="n">x1</span><span class="p">))</span>
                      <span class="n">k2</span>
                      <span class="n">x2</span>
                  <span class="kr">_</span> <span class="ow">-&gt;</span>
                    <span class="n">undefined</span>
          <span class="kr">_</span> <span class="ow">-&gt;</span>
            <span class="kt">Node</span> <span class="kt">Red</span> <span class="p">(</span><span class="n">delete&#39;</span> <span class="n">l0</span><span class="p">)</span> <span class="n">r0</span> <span class="n">k0</span> <span class="n">x0</span>
      <span class="kt">EQ</span> <span class="ow">-&gt;</span>
        <span class="n">cat</span> <span class="n">l0</span> <span class="n">r0</span>
      <span class="kt">GT</span> <span class="ow">-&gt;</span>
        <span class="kr">case</span> <span class="n">r0</span> <span class="kr">of</span>
          <span class="kt">Node</span> <span class="kt">Black</span> <span class="kr">_</span> <span class="kr">_</span> <span class="kr">_</span> <span class="kr">_</span> <span class="ow">-&gt;</span>
            <span class="kr">case</span> <span class="n">delete&#39;</span> <span class="n">r0</span> <span class="kr">of</span>
              <span class="kt">Node</span> <span class="kt">Red</span> <span class="n">l1</span> <span class="n">r1</span> <span class="n">k1</span> <span class="n">x1</span> <span class="ow">-&gt;</span>
                <span class="kt">Node</span> <span class="kt">Red</span> <span class="n">l0</span> <span class="p">(</span><span class="kt">Node</span> <span class="kt">Black</span> <span class="n">l1</span> <span class="n">r1</span> <span class="n">k1</span> <span class="n">x1</span><span class="p">)</span> <span class="n">k0</span> <span class="n">x0</span>
              <span class="n">r0&#39;</span> <span class="ow">-&gt;</span>
                <span class="kr">case</span> <span class="n">l0</span> <span class="kr">of</span>
                  <span class="kt">Node</span> <span class="kt">Black</span> <span class="n">l1</span> <span class="n">r1</span> <span class="n">k1</span> <span class="n">x1</span> <span class="ow">-&gt;</span>
                    <span class="n">balance</span> <span class="p">(</span><span class="kt">Node</span> <span class="kt">Black</span> <span class="p">(</span><span class="kt">Node</span> <span class="kt">Red</span> <span class="n">l1</span> <span class="n">r1</span> <span class="n">k1</span> <span class="n">x1</span><span class="p">)</span> <span class="n">r0&#39;</span> <span class="n">k0</span> <span class="n">x0</span><span class="p">)</span>
                  <span class="kt">Node</span> <span class="kt">Red</span> <span class="n">l1</span> <span class="p">(</span><span class="kt">Node</span> <span class="kt">Black</span> <span class="n">l2</span> <span class="n">r2</span> <span class="n">k2</span> <span class="n">x2</span><span class="p">)</span> <span class="n">k1</span> <span class="n">x1</span> <span class="ow">-&gt;</span>
                    <span class="kt">Node</span>
                      <span class="kt">Red</span>
                      <span class="p">(</span><span class="n">balance</span> <span class="p">(</span><span class="kt">Node</span> <span class="kt">Black</span> <span class="p">(</span><span class="n">toRed</span> <span class="n">l1</span><span class="p">)</span> <span class="n">l2</span> <span class="n">k1</span> <span class="n">x1</span><span class="p">))</span>
                      <span class="p">(</span><span class="kt">Node</span> <span class="kt">Black</span> <span class="n">r2</span> <span class="n">r0&#39;</span> <span class="n">k0</span> <span class="n">x0</span><span class="p">)</span>
                      <span class="n">k2</span>
                      <span class="n">x2</span>
                  <span class="kr">_</span> <span class="ow">-&gt;</span>
                    <span class="n">undefined</span>
          <span class="kr">_</span> <span class="ow">-&gt;</span>
            <span class="kt">Node</span> <span class="kt">Red</span> <span class="n">l0</span> <span class="p">(</span><span class="n">delete&#39;</span> <span class="n">r0</span><span class="p">)</span> <span class="n">k0</span> <span class="n">x0</span>

<span class="nf">null</span> <span class="ow">::</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span>
<span class="nf">null</span> <span class="kt">Empty</span> <span class="ow">=</span> <span class="kt">True</span>
<span class="nf">null</span> <span class="kr">_</span> <span class="ow">=</span> <span class="kt">False</span>

<span class="nf">member</span> <span class="ow">::</span> <span class="kt">Ord</span> <span class="n">k</span> <span class="ow">=&gt;</span> <span class="n">k</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span>
<span class="nf">member</span> <span class="n">k</span> <span class="ow">=</span> <span class="kt">Maybe</span><span class="o">.</span><span class="n">isJust</span> <span class="o">.</span> <span class="n">lookup</span> <span class="n">k</span>

<span class="nf">insertBy</span> <span class="ow">::</span> <span class="kt">Ord</span> <span class="n">k</span> <span class="ow">=&gt;</span> <span class="p">(</span><span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">a</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">k</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span>
<span class="nf">insertBy</span> <span class="n">f</span> <span class="n">k</span> <span class="n">x</span> <span class="n">rbMap</span> <span class="ow">=</span>
  <span class="kr">case</span> <span class="n">lookup</span> <span class="n">k</span> <span class="n">rbMap</span> <span class="kr">of</span>
    <span class="kt">Nothing</span> <span class="ow">-&gt;</span>
      <span class="n">insert</span> <span class="n">k</span> <span class="n">x</span> <span class="n">rbMap</span>
    <span class="kt">Just</span> <span class="n">x&#39;</span> <span class="ow">-&gt;</span>
      <span class="n">insert</span> <span class="n">k</span> <span class="p">(</span><span class="n">f</span> <span class="n">x</span> <span class="n">x&#39;</span><span class="p">)</span> <span class="n">rbMap</span>

<span class="nf">alter</span> <span class="ow">::</span> <span class="kt">Ord</span> <span class="n">k</span> <span class="ow">=&gt;</span> <span class="p">(</span><span class="kt">Maybe</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Maybe</span> <span class="n">a</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">k</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span>
<span class="nf">alter</span> <span class="n">f</span> <span class="n">k</span> <span class="n">rbMap</span> <span class="ow">=</span>
  <span class="kr">case</span> <span class="n">f</span> <span class="p">(</span><span class="n">lookup</span> <span class="n">k</span> <span class="n">rbMap</span><span class="p">)</span> <span class="kr">of</span>
    <span class="kt">Nothing</span> <span class="ow">-&gt;</span>
      <span class="n">delete</span> <span class="n">k</span> <span class="n">rbMap</span>
    <span class="kt">Just</span> <span class="n">x&#39;</span> <span class="ow">-&gt;</span>
      <span class="n">insert</span> <span class="n">k</span> <span class="n">x&#39;</span> <span class="n">rbMap</span>

<span class="nf">update</span> <span class="ow">::</span> <span class="kt">Ord</span> <span class="n">k</span> <span class="ow">=&gt;</span> <span class="p">(</span><span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Maybe</span> <span class="n">a</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">k</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span>
<span class="nf">update</span> <span class="ow">=</span> <span class="n">alter</span> <span class="o">.</span> <span class="n">maybe</span> <span class="kt">Nothing</span>

<span class="nf">adjust</span> <span class="ow">::</span> <span class="kt">Ord</span> <span class="n">k</span> <span class="ow">=&gt;</span> <span class="p">(</span><span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">a</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">k</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span>
<span class="nf">adjust</span> <span class="n">f</span> <span class="ow">=</span> <span class="n">update</span> <span class="o">$</span> <span class="kt">Just</span> <span class="o">.</span> <span class="n">f</span>

<span class="nf">unionBy</span> <span class="ow">::</span> <span class="kt">Ord</span> <span class="n">k</span> <span class="ow">=&gt;</span> <span class="p">(</span><span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">a</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span>
<span class="nf">unionBy</span> <span class="ow">=</span> <span class="n">foldri</span> <span class="o">.</span> <span class="n">insertBy</span> <span class="o">.</span> <span class="n">flip</span>

<span class="nf">unionsBy</span> <span class="ow">::</span> <span class="kt">Ord</span> <span class="n">k</span> <span class="ow">=&gt;</span> <span class="p">(</span><span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">a</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span><span class="p">]</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span>
<span class="nf">unionsBy</span> <span class="n">f</span> <span class="ow">=</span> <span class="kt">Prelude</span><span class="o">.</span><span class="n">foldr</span> <span class="p">(</span><span class="n">unionBy</span> <span class="n">f</span><span class="p">)</span> <span class="n">empty</span>

<span class="nf">unionl</span> <span class="ow">::</span> <span class="kt">Ord</span> <span class="n">k</span> <span class="ow">=&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span>
<span class="nf">unionl</span> <span class="ow">=</span> <span class="n">unionBy</span> <span class="n">const</span>

<span class="nf">unionr</span> <span class="ow">::</span> <span class="kt">Ord</span> <span class="n">k</span> <span class="ow">=&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span>
<span class="nf">unionr</span> <span class="ow">=</span> <span class="n">unionBy</span> <span class="o">$</span> <span class="n">const</span> <span class="n">id</span>

<span class="nf">interBy</span> <span class="ow">::</span> <span class="kt">Ord</span> <span class="n">k</span> <span class="ow">=&gt;</span> <span class="p">(</span><span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">a</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span>
<span class="nf">interBy</span> <span class="n">f</span> <span class="n">rbMap</span> <span class="ow">=</span> <span class="n">flip</span> <span class="n">foldri</span> <span class="n">empty</span> <span class="o">$</span> <span class="nf">\</span><span class="n">k</span> <span class="n">x</span> <span class="ow">-&gt;</span>
  <span class="kr">case</span> <span class="n">lookup</span> <span class="n">k</span> <span class="n">rbMap</span> <span class="kr">of</span>
    <span class="kt">Nothing</span> <span class="ow">-&gt;</span>
      <span class="n">id</span>
    <span class="kt">Just</span> <span class="n">x&#39;</span> <span class="ow">-&gt;</span>
      <span class="n">insert</span> <span class="n">k</span> <span class="o">$</span> <span class="n">f</span> <span class="n">x&#39;</span> <span class="n">x</span>

<span class="nf">interl</span> <span class="ow">::</span> <span class="kt">Ord</span> <span class="n">k</span> <span class="ow">=&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span>
<span class="nf">interl</span> <span class="ow">=</span> <span class="n">interBy</span> <span class="n">const</span>

<span class="nf">interr</span> <span class="ow">::</span> <span class="kt">Ord</span> <span class="n">k</span> <span class="ow">=&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span>
<span class="nf">interr</span> <span class="ow">=</span> <span class="n">interBy</span> <span class="o">$</span> <span class="n">const</span> <span class="n">id</span>

<span class="nf">diffBy</span> <span class="ow">::</span> <span class="kt">Ord</span> <span class="n">k</span> <span class="ow">=&gt;</span> <span class="p">(</span><span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Maybe</span> <span class="n">a</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span>
<span class="nf">diffBy</span> <span class="n">f</span> <span class="ow">=</span> <span class="n">foldri</span> <span class="o">$</span> <span class="n">flip</span> <span class="o">$</span> <span class="n">update</span> <span class="o">.</span> <span class="n">flip</span> <span class="n">f</span>

<span class="nf">diff</span> <span class="ow">::</span> <span class="kt">Ord</span> <span class="n">k</span> <span class="ow">=&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span>
<span class="nf">diff</span> <span class="ow">=</span> <span class="n">diffBy</span> <span class="o">$</span> <span class="nf">\</span><span class="kr">_</span> <span class="kr">_</span> <span class="ow">-&gt;</span> <span class="kt">Nothing</span>

<span class="nf">keys</span> <span class="ow">::</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">k</span><span class="p">]</span>
<span class="nf">keys</span> <span class="ow">=</span> <span class="n">foldri</span> <span class="p">(</span><span class="n">const</span> <span class="o">.</span> <span class="p">(</span><span class="kt">:</span><span class="p">))</span> <span class="kt">[]</span>

<span class="nf">elts</span> <span class="ow">::</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span>
<span class="nf">elts</span> <span class="ow">=</span> <span class="n">foldr</span> <span class="p">(</span><span class="kt">:</span><span class="p">)</span> <span class="kt">[]</span>

<span class="nf">maximumKey</span> <span class="ow">::</span> <span class="kt">Ord</span> <span class="n">k</span> <span class="ow">=&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Maybe</span> <span class="n">k</span>
<span class="nf">maximumKey</span> <span class="ow">=</span> <span class="n">maximumKey&#39;</span> <span class="kt">Nothing</span> <span class="kr">where</span>
  <span class="n">maximumKey&#39;</span> <span class="n">z</span> <span class="kt">Empty</span> <span class="ow">=</span> <span class="n">z</span>
  <span class="n">maximumKey&#39;</span> <span class="kr">_</span> <span class="p">(</span><span class="kt">Node</span> <span class="kr">_</span> <span class="kr">_</span> <span class="n">r</span> <span class="n">k</span> <span class="kr">_</span><span class="p">)</span> <span class="ow">=</span> <span class="n">maximumKey&#39;</span> <span class="p">(</span><span class="kt">Just</span> <span class="n">k</span><span class="p">)</span> <span class="n">r</span>

<span class="nf">minimumKey</span> <span class="ow">::</span> <span class="kt">Ord</span> <span class="n">k</span> <span class="ow">=&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Maybe</span> <span class="n">k</span>
<span class="nf">minimumKey</span> <span class="ow">=</span> <span class="n">minimumKey&#39;</span> <span class="kt">Nothing</span> <span class="kr">where</span>
  <span class="n">minimumKey&#39;</span> <span class="n">z</span> <span class="kt">Empty</span> <span class="ow">=</span> <span class="n">z</span>
  <span class="n">minimumKey&#39;</span> <span class="kr">_</span> <span class="p">(</span><span class="kt">Node</span> <span class="kr">_</span> <span class="n">l</span> <span class="kr">_</span> <span class="n">k</span> <span class="kr">_</span><span class="p">)</span> <span class="ow">=</span> <span class="n">minimumKey&#39;</span> <span class="p">(</span><span class="kt">Just</span> <span class="n">k</span><span class="p">)</span> <span class="n">l</span>

<span class="nf">maximum</span> <span class="ow">::</span> <span class="kt">Ord</span> <span class="n">a</span> <span class="ow">=&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Maybe</span> <span class="n">a</span>
<span class="nf">maximum</span> <span class="n">rbMap</span> <span class="ow">=</span>
  <span class="kr">let</span> <span class="n">alist</span> <span class="ow">=</span> <span class="n">elts</span> <span class="n">rbMap</span> <span class="kr">in</span>
    <span class="kr">if</span> <span class="kt">Prelude</span><span class="o">.</span><span class="n">null</span> <span class="n">alist</span> <span class="kr">then</span>
      <span class="kt">Nothing</span>
    <span class="kr">else</span>
      <span class="kt">Just</span> <span class="o">$</span> <span class="kt">List</span><span class="o">.</span><span class="n">maximum</span> <span class="n">alist</span>

<span class="nf">minimum</span> <span class="ow">::</span> <span class="kt">Ord</span> <span class="n">a</span> <span class="ow">=&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Maybe</span> <span class="n">a</span>
<span class="nf">minimum</span> <span class="n">rbMap</span> <span class="ow">=</span>
  <span class="kr">let</span> <span class="n">alist</span> <span class="ow">=</span> <span class="n">elts</span> <span class="n">rbMap</span> <span class="kr">in</span>
    <span class="kr">if</span> <span class="kt">Prelude</span><span class="o">.</span><span class="n">null</span> <span class="n">alist</span> <span class="kr">then</span>
      <span class="kt">Nothing</span>
    <span class="kr">else</span>
      <span class="kt">Just</span> <span class="o">$</span> <span class="kt">List</span><span class="o">.</span><span class="n">minimum</span> <span class="n">alist</span>

<span class="nf">toList</span> <span class="ow">::</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="p">[(</span><span class="n">k</span><span class="p">,</span> <span class="n">a</span><span class="p">)]</span>
<span class="nf">toList</span> <span class="ow">=</span> <span class="n">foldri</span> <span class="p">(</span><span class="nf">\</span><span class="n">k</span> <span class="n">x</span> <span class="ow">-&gt;</span> <span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="kt">:</span><span class="p">))</span> <span class="kt">[]</span>

<span class="nf">fromList</span> <span class="ow">::</span> <span class="kt">Ord</span> <span class="n">k</span> <span class="ow">=&gt;</span> <span class="p">[(</span><span class="n">k</span><span class="p">,</span> <span class="n">a</span><span class="p">)]</span> <span class="ow">-&gt;</span> <span class="kt">RBMap</span> <span class="n">k</span> <span class="n">a</span>
<span class="nf">fromList</span> <span class="ow">=</span> <span class="kt">Prelude</span><span class="o">.</span><span class="n">foldr</span> <span class="p">(</span><span class="n">uncurry</span> <span class="n">insert</span><span class="p">)</span> <span class="n">empty</span>
</pre></div>
</div>
</body>
</html>
