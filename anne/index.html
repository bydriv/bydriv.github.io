<!DOCTYPE html><!--

--><meta charset="utf-8"><!--
--><meta name="viewport" content="width=device-width, initial-scale=1"><!--
--><title>bydriv.github.io</title><!--

--><link rel="stylesheet" type="text/css" href="/prelude/style.css"><!--

--><div class="taskbar"><!--
--><a class="icon" href="/">&#x221A;</a><!--
--><a class="icon" href="/about">&#x1F4BD;</a><!--
--><a class="icon" href="/gallery">&#x1F3A8;</a><!--
--><a class="icon" href="/novel/golden-record">&#x1F30C;</a><!--
--><a class="icon" href="/novel/rcs">&#x1F303;</a><!--
--><a class="icon" href="/anne">&#x1F45A;</a><!--
--><a class="icon" href="/worldview">&#x1F30D;</a><!--
--></div>
<div class=window><div class=header>Anne: Specification</div>
  <div class=content><h2 >Anne: 軽量データ構造
</h2>
<h3 >概要
</h3>
<p>Anne は人間が書くための軽量なデータ構造である。
この文書は Anne の定義を記述するものである。
</p>
<h3 >字句
</h3>
<p>Anne の字句は6種類であり、すなわち
</p>
<ul ><li ><code >[</code></li>
<li ><code >]</code></li>
<li >空行 (<b >BLANK</b> と表す)</li>
<li >文章 (<b >TEXT</b> と表す)</li>
<li >単行生文章 (<b >RAW1</b> と表す)</li>
<li >複行生文章 (<b >RAWN</b> と表す)</li>
</ul>
<p>である。
</p>
<p>字句に関する形式的な議論は複雑になるため避け、ここでは直観的に説明する。
</p>
<p>まず、 <code >[</code> や <code >]</code> はそれ自体が字句である。
</p>
<p>空行とは行頭から行末に至るまで改行のみからなる文字列である。
ただし改行とは <code >&bsol;n</code> または <code >&bsol;r</code> または <code >&bsol;r&bsol;n</code> である。
</p>
<p>単行生文章は、たとえば <code >&lt;|hello world|</code> のように、 <code >&lt;d</code> から始まり <code >d</code> で終わる文字列である。
ただし <code >d</code> は <code >&lt;</code> 以外の任意の1文字である。
</p>
<p>複行生文章は、たとえば
</p>
<pre >&lt;&lt;CODE
hello world
CODE
</pre>
<p>のように、 <code >/&lt;&lt;d$/</code> から始まり <code >/^d$/</code> で終わる文字列である。
ただし <code >d</code> は任意の行末までの文字列であり、一致していなければならない。
</p>
<p>最後に文章とは、それ以外の文字列である。
例外として、 <code >&lt;</code> や <code >[</code> のような予約された記号は、
<code >&bsol;&lt;</code> や <code >&bsol;[</code> のようにエスケープしなければならない。
</p>
<h3 >文法
</h3>
<table ><tr ><td ><em >anne</em>     </td> <td >::=</td> <td ><em >(* empty *)</em>                        </td></tr>
<tr ><td ></td> <td >|</td> <td ><em >document</em>                           </td></tr>
<tr ><td ><em >document</em> </td> <td >::=</td> <td ><em >paragraph</em>                          </td></tr>
<tr ><td ></td> <td >|</td> <td ><em >paragraph</em> <b >BLANK</b> <em >document</em></td></tr>
<tr ><td ><em >paragraph</em></td> <td >::=</td> <td ><em >datum</em>                              </td></tr>
<tr ><td ></td> <td >|</td> <td ><em >datum</em> <em >paragraph</em>              </td></tr>
<tr ><td ><em >data</em>     </td> <td >::=</td> <td ><em >(* empty *)</em>                        </td></tr>
<tr ><td ></td> <td >|</td> <td ><em >datum</em> <em >data</em>                   </td></tr>
<tr ><td ><em >datum</em>    </td> <td >::=</td> <td ><em >atom</em>                               </td></tr>
<tr ><td ></td> <td >|</td> <td ><em >list</em>                               </td></tr>
<tr ><td ><em >atom</em>     </td> <td >::=</td> <td ><b >TEXT</b>                                </td></tr>
<tr ><td ></td> <td >|</td> <td ><b >RAW1</b>                                </td></tr>
<tr ><td ></td> <td >|</td> <td ><b >RAWN</b>                                </td></tr>
<tr ><td ><em >list</em>     </td> <td >::=</td> <td ><code >[</code> <em >data</em> <code >]</code>         </td></tr>
</table>
<h3 >例
</h3>
<p>データ構造としての Anne を説明するために、 JSON との対応を例示する。
</p>
<p><b >example.anne</b>:
</p>
<pre >data1-atom: atom
data1-list: [list]
data1-tree: [tree [leaf] [leaf]]

data2-atom:
  atom
data2-list:
  [list]
data2-tree:
  [tree
    [leaf]
    [leaf]]

&lt;&lt;DATA
data3-atom: atom
data3-list: [list]
data3-tree: [tree [leaf] [leaf]]
DATA
</pre>
<p>上記の Anne ファイルは、以下の JSON ファイルと等価である。
</p>
<p><b >example.json</b>:
</p>
<pre >{
  "type": "document",
  "value": [
    {
      "type": "paragraph",
      "value": [
        {
          "type": "text",
          "value": "data1-atom: atom&bsol;n"
        },
        {
          "type": "text",
          "value": "data1-list: "
        },
        {
          "type": "list",
          "value": {
            "type": "data",
            "value": [
              {
                "type": "text",
                "value": "list"
              }
            ]
          }
        },
        {
          "type": "text",
          "value": "&bsol;n"
        },
        {
          "type": "text",
          "value": "data1-tree: "
        },
        {
          "type": "list",
          "value": {
            "type": "data",
            "value": [
              {
                "type": "text",
                "value": "tree "
              },
              {
                "type": "list",
                "value": {
                  "type": "data",
                  "value": [
                    {
                      "type": "text",
                      "value": "leaf"
                    }
                  ]
                }
              },
              {
                "type": "text",
                "value": " "
              },
              {
                "type": "list",
                "value": {
                  "type": "data",
                  "value": [
                    {
                      "type": "text",
                      "value": "leaf"
                    }
                  ]
                }
              }
            ]
          }
        },
        {
          "type": "text",
          "value": "&bsol;n"
        }
      ]
    },
    {
      "type": "blank",
      "value": "&bsol;n"
    },
    {
      "type": "paragraph",
      "value": [
        {
          "type": "text",
          "value": "data2-atom:&bsol;n"
        },
        {
          "type": "text",
          "value": "  atom&bsol;n"
        },
        {
          "type": "text",
          "value": "data2-list:&bsol;n"
        },
        {
          "type": "text",
          "value": "  "
        },
        {
          "type": "list",
          "value": {
            "type": "data",
            "value": [
              {
                "type": "text",
                "value": "list"
              }
            ]
          }
        },
        {
          "type": "text",
          "value": "&bsol;n"
        },
        {
          "type": "text",
          "value": "data2-tree:&bsol;n"
        },
        {
          "type": "text",
          "value": "  "
        },
        {
          "type": "list",
          "value": {
            "type": "data",
            "value": [
              {
                "type": "text",
                "value": "tree&bsol;n"
              },
              {
                "type": "text",
                "value": "    "
              },
              {
                "type": "list",
                "value": {
                  "type": "data",
                  "value": [
                    {
                      "type": "text",
                      "value": "leaf"
                    }
                  ]
                }
              },
              {
                "type": "text",
                "value": "&bsol;n"
              },
              {
                "type": "text",
                "value": "    "
              },
              {
                "type": "list",
                "value": {
                  "type": "data",
                  "value": [
                    {
                      "type": "text",
                      "value": "leaf"
                    }
                  ]
                }
              }
            ]
          }
        },
        {
          "type": "text",
          "value": "&bsol;n"
        }
      ]
    },
    {
      "type": "blank",
      "value": "&bsol;n"
    },
    {
      "type": "paragraph",
      "value": [
        {
          "type": "rawn",
          "delimiter": "DATA&bsol;n",
          "value": "data3-atom: atom&bsol;ndata3-list: [list]&bsol;ndata3-tree: [tree [leaf] [leaf]]&bsol;n"
        }
      ]
    }
  ]
}
</pre>
</div>
</div>
<div class=window><div class=header>Anne: Cheatsheet</div>
  <div class=content><h2 >Anne チートシート
</h2>
<h3 >インストール方法
</h3>
<pre >$ git clone git://github.com/bydrv/bydriv.github.io
$ cd bydriv.github.io/anne
$ stack install
$ anne &lt; foo.anne
</pre>
<h3 >Anne と Shirley について
</h3>
<ul ><li >Anne はシリアライズフォーマット</li>
<li >Shirley はそれを処理してべつの形式に変換するプロセッサ</li>
</ul>
<p>ここには Anne のことのみを書く。
Shirley のことは Shirley チートシートを参照のこと。
</p>
<p>Anne は必ずしも JSON に変換しなければならない形式ではない。
Haskell の <code >Data.Anne</code> モジュールを使えば Anne をそのまま処理できる。
とはいえ jq などを使うことを考えると、 JSON に変換したほうがいろいろと都合がいい。
</p>
<h3 >段落
</h3>
<pre >段落1-行1
段落1-行2

段落2-行1
段落2-行2
</pre>
<h3 >raw 文字列
</h3>
<pre >&lt;|foo|
&lt;!bar!
</pre>
<h3 >ヒアドキュメント
</h3>
<pre >&lt;&lt;CODE
Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
CODE
</pre>
<h3 >リスト
</h3>
<pre >[リスト]
[木 [枝] [枝]]
</pre>
</div>
</div>
<div class=window><div class=header>Shirley: Cheatsheet</div>
  <div class=content><h2 >Shirley チートシート
</h2>
<h3 >インストール方法
</h3>
<p><a href=https://github.com/bydriv/bydriv.github.io/blob/master/anne/lib/shirley.rb>https://github.com/bydriv/bydriv.github.io/blob/master/anne/lib/shirley.rb</a> をどこか RUBYLIB の通ったディレクトリに置く。
</p>
<h3 >Shirley について
</h3>
<p>Shirley は Anne (を変換した JSON) を処理するライブラリ。
具体的な処理はそれを使って書く。
</p>
<h4 >HTML 用の Shirley
</h4>
<p><a href=https://github.com/bydriv/bydriv.github.io/blob/master/anne/shirley/html.rb>https://github.com/bydriv/bydriv.github.io/blob/master/anne/shirley/html.rb</a> がある。
</p>
<p>このページでは Shirley 自体の使いかたではなく、この HTML 用の Shirley を中心に解説する。
</p>
<h3 >エスケープ処理
</h3>
<p>&amp; は &amp;amp; に、 &bsol; は &amp;bsol; に、 &lt; は &amp;lt; に、 &gt; は &amp;gt; にエスケープされる。
</p>
<p>これは Anne の仕様でも Shirley の仕様でもなく、 HTML 用の Shirley の仕様であることに注意。
</p>
<h3 >タグ
</h3>
<p>[#tag(attr1=val1 attr2=val2) text] のように書く。
属性や text は省略できる。段落のいちばん外側で [] を書かなければブロック要素になる。
例。
</p>
<pre >#h1 aaa

#h2 bbb

#div(class=container) [content]

[#img(src=cute.png)]
[#a(href=#foo) foo]
</pre>
<p>基本的に、 [] でかこったものはインライン要素、そうでないものがブロック要素と解釈される。
</p>
<p>なお、
</p>
<pre >#h1 aaa
#h2 bbb
</pre>
<p>というように空行を書かないと、
</p>
<pre >&lt;h1&gt;aaa
#h2 bbb&lt;/h1&gt;
</pre>
<p>となってしまうことに注意。
</p>
<p>Anne の段落 = HTML 用の Shirley のブロック要素となっているので、
ひとつの段落に複数のブロック要素を書くことは基本的にできない。
</p>
<p>(より詳細な実装の話として、タグは段落の先頭か、 [] でかこった部分の先頭にしか書けない。
たとえば [#aaa #bbb] のようにしても、 &lt;aaa&gt;&lt;bbb&gt;&lt;/bbb&gt;&lt;/aaa&gt; のようになるわけではなく、
&lt;aaa&gt;#bbb&lt;/aaa&gt; のようになる。
もし前者のようにしたいなら、 [#aaa[#bbb]] としなければならない。
</p>
</div>
</div>
