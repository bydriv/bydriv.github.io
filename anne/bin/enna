#!/usr/bin/ruby

require "json"

module Enna
  extend self

  def escape(s)
    s.gsub(/([<\[\\\]{}]|(?:\n\r(?!\z)))/) { "\\#$1" }
  end

  def traverse(json)
    case json["type"]
    when "blank"
      json["value"]
    when "text"
      escape(json["value"])
    when "raw1"
      "<#{json["delimiter"]}#{json["value"]}#{json["delimiter"]}"
    when "rawn"
      "<<#{json["delimiter"]}#{json["value"]}#{json["delimiter"]}"
    when "list"
      "[" + traverse(json["value"]) + "]"
    when "document", "paragraph", "data"
      json["value"].map do |child|
        traverse(child)
      end.join("")
    end
  end
end

puts(Enna.traverse(JSON.parse(ARGF.read)))
