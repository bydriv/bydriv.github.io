<h2 >Anne: 軽量データ構造
</h2>
<h3 >概要
</h3>
<p>Anne は人間が書くための軽量なデータ構造である。
この文書は Anne の定義を記述するものである。
</p>
<h3 >字句
</h3>
<p>Anne の字句は4種類であり、すなわち
</p>
<ul ><li ><code >[</code></li>
<li ><code >]</code></li>
<li >空行 (<b >BLANK</b> と表す)</li>
<li >文章 (<b >TEXT</b> と表す)</li>
<li >単行生文章 (<b >RAW1</b> と表す)</li>
<li >複行生文章 (<b >RAWN</b> と表す)</li>
</ul>
<p>である。
</p>
<p>字句に関する形式的な議論は複雑になるため避け、ここでは直観的に説明する。
</p>
<p>まず、 <code >[</code> や <code >]</code> はそれ自体が字句である。
</p>
<p>空行とは行頭から行末に至るまで改行のみからなる文字列である。
ただし改行とは <code >&bsol;n</code> または <code >&bsol;r</code> または <code >&bsol;r&bsol;n</code> である。
</p>
<p>単行生文章は、たとえば <code >&lt;|hello world|</code> のように、 <code >&lt;d</code> から始まり <code >d</code> で終わる文字列である。
ただし <code >d</code> は <code >&lt;</code> 以外の任意の1文字である。
</p>
<p>複行生文章は、たとえば
</p>
<pre >&lt;&lt;CODE
hello world
CODE
</pre>
<p>のように、 <code >/&lt;&lt;d$/</code> から始まり <code >/^d$</code> で終わる文字列である。
ただし <code >d</code> は任意の行末までの文字列であり、一致していなければならない。
</p>
<p>最後に文章とは、それ以外の文字列である。
例外として、 <code >&lt;</code> や <code >[</code> のような予約された記号は、
<code >&bsol;&lt;</code> や <code >&bsol;[</code> のようにエスケープしなければならない。
</p>
<h3 >文法
</h3>
<table ><tr ><td ><em >anne</em> </td> <td >::=</td> <td ><em >data</em>                      </td></tr>
<tr ><td ></td> <td >|</td> <td ><em >data</em> <b >BLANK</b> <em >anne</em></td></tr>
<tr ><td ><em >data</em> </td> <td >::=</td> <td ><em >(* empty *)</em>               </td></tr>
<tr ><td ></td> <td >|</td> <td ><em >datum</em> <em >data</em>          </td></tr>
<tr ><td ><em >datum</em></td> <td >::=</td> <td ><em >atom</em>                      </td></tr>
<tr ><td ></td> <td >|</td> <td ><em >list</em>                      </td></tr>
<tr ><td ><em >atom</em> </td> <td >::=</td> <td ><b >TEXT</b>                       </td></tr>
<tr ><td ></td> <td >|</td> <td ><b >RAW1</b>                       </td></tr>
<tr ><td ></td> <td >|</td> <td ><b >RAWN</b>                       </td></tr>
<tr ><td ><em >list</em> </td> <td >::=</td> <td ><code >[</code> <em >data</em> <code >]</code></td></tr>
</table>
<h3 >例
</h3>
<p>データ構造としての Anne を説明するために、 JSON との対応を例示する。
</p>
<p><b >example.anne</b>:
</p>
<pre >data1-atom: atom
data1-list: [list]
data1-tree: [tree [leaf] [leaf]]

data2-atom:
  atom
data2-list:
  [list]
data2-tree:
  [tree
    [leaf]
    [leaf]]

&lt;&lt;DATA
data3-atom: atom
data3-list: [list]
data3-tree: [tree [leaf] [leaf]]
DATA
</pre>
<p>上記の Anne ファイルは、以下の JSON ファイルと等価である。
</p>
<p><b >example.json</b>:
</p>
<pre >{
  "type": "anne",
  "value": [
    {
      "type": "paragraph",
      "value": [
        {
          "type": "text",
          "value": "data1-atom: atom&bsol;n"
        },
        {
          "type": "text",
          "value": "data1-list: "
        },
        {
          "type": "list",
          "value": [
            {
              "type": "text",
              "value": "list"
            }
          ]
        },
        {
          "type": "text",
          "value": "&bsol;n"
        },
        {
          "type": "text",
          "value": "data1-tree: "
        },
        {
          "type": "list",
          "value": [
            {
              "type": "text",
              "value": "tree "
            },
            {
              "type": "list",
              "value": [
                {
                  "type": "text",
                  "value": "leaf"
                }
              ]
            },
            {
              "type": "text",
              "value": " "
            },
            {
              "type": "list",
              "value": [
                {
                  "type": "text",
                  "value": "leaf"
                }
              ]
            }
          ]
        },
        {
          "type": "text",
          "value": "&bsol;n"
        }
      ]
    },
    {
      "type": "blank",
      "value": "&bsol;n"
    },
    {
      "type": "paragraph",
      "value": [
        {
          "type": "text",
          "value": "data2-atom:&bsol;n"
        },
        {
          "type": "text",
          "value": "  atom&bsol;n"
        },
        {
          "type": "text",
          "value": "data2-list:&bsol;n"
        },
        {
          "type": "text",
          "value": "  "
        },
        {
          "type": "list",
          "value": [
            {
              "type": "text",
              "value": "list"
            }
          ]
        },
        {
          "type": "text",
          "value": "&bsol;n"
        },
        {
          "type": "text",
          "value": "data2-tree:&bsol;n"
        },
        {
          "type": "text",
          "value": "  "
        },
        {
          "type": "list",
          "value": [
            {
              "type": "text",
              "value": "tree&bsol;n"
            },
            {
              "type": "text",
              "value": "    "
            },
            {
              "type": "list",
              "value": [
                {
                  "type": "text",
                  "value": "leaf"
                }
              ]
            },
            {
              "type": "text",
              "value": "&bsol;n"
            },
            {
              "type": "text",
              "value": "    "
            },
            {
              "type": "list",
              "value": [
                {
                  "type": "text",
                  "value": "leaf"
                }
              ]
            }
          ]
        },
        {
          "type": "text",
          "value": "&bsol;n"
        }
      ]
    },
    {
      "type": "blank",
      "value": "&bsol;n"
    },
    {
      "type": "paragraph",
      "value": [
        {
          "type": "rawn",
          "delimiter": "DATA&bsol;n",
          "value": "data3-atom: atom&bsol;ndata3-list: [list]&bsol;ndata3-tree: [tree [leaf] [leaf]]&bsol;n"
        }
      ]
    }
  ]
}
</pre>
