<h2>Anne: 軽量データ構造
</h2>
<h3>概要
</h3>
<p>Anne は人間が書くための軽量なデータ構造である。
この文書は Anne の定義を記述するものである。
</p>
<h3>字句
</h3>
<p>Anne の字句は4種類であり、すなわち
</p>
<ul><li><code>[</code></li>
<li><code>]</code></li>
<li>空行 (<b>BLANK</b> と表す)</li>
<li>文字列 (<b>STRING</b> と表す)</li>
</ul>
<p>である。
</p>
<p>このうち、 <code>[</code> と <code>]</code> は自明であろう。
空行は <code>/^\n$/</code> で指定される。
文字列にはいくつか種類がある。
ひとつめは <code>/([^\n\[\]<]|\\[\n\[\]<])+\n/</code> で指定されるものである。
ふたつめはすべての K = <code>/[^<]/</code> について <code>/<K.*?K/</code> で指定されるものである。
みっつめはすべての K = <code>/[^\n]+/</code> について <code>/<<K\n.*?\nK\n/</code> で指定されるものであり、
ヒアドキュメントと呼ばれる。 K は一致している必要がある。
たとえば <code>/<<CODE\n.*?\nCODE\n/</code> や <code>/<<DOC\n.*?\nDOC\n/</code>
はヒアドキュメントだが <code>/<<DOC\n.*?\nCODE\n/</code> はヒアドキュメントではない。
</p>
<h3>文法
</h3>
<table><tr><td><em>anne</em> </td> <td>::=</td> <td><em>data</em>                      </td></tr>
<tr><td></td> <td>|</td> <td><em>data</em> <b>BLANK</b> <em>anne</em></td></tr>
<tr><td><em>data</em> </td> <td>::=</td> <td><em>(* empty *)</em>               </td></tr>
<tr><td></td> <td>|</td> <td><em>datum</em> <em>data</em>          </td></tr>
<tr><td><em>datum</em></td> <td>::=</td> <td><em>atom</em>                      </td></tr>
<tr><td></td> <td>|</td> <td><em>list</em>                      </td></tr>
<tr><td><em>atom</em> </td> <td>::=</td> <td><b>STRING</b>                     </td></tr>
<tr><td><em>list</em> </td> <td>::=</td> <td><code>[</code> <em>data</em> <code>]</code></td></tr>
</table>
<h3>例
</h3>
<p>データ構造としての Anne を説明するために、 JSON との対応を例示する。
</p>
<p><b>example.anne</b>:
</p>
<pre>data1-atom: atom
data1-list: [list]
data1-tree: [tree [leaf] [leaf]]

data2-atom:
  atom
data2-list:
  [list]
data2-tree:
  [tree
    [leaf]
    [leaf]]

<<DATA
data3-atom: atom
data3-list: [list]
data3-tree: [tree [leaf] [leaf]]
DATA
</pre>
<p>上記の Anne ファイルは、以下の JSON ファイルと等価である。
</p>
<p><b>example.json</b>:
</p>
<pre>[
  [
    {
      "type": "text",
      "value": "data1-atom: atom\n"
    },
    {
      "type": "text",
      "value": "data1-list: "
    },
    [
      {
        "type": "text",
        "value": "list"
      }
    ],
    {
      "type": "text",
      "value": "\n"
    },
    {
      "type": "text",
      "value": "data1-tree: "
    },
    [
      {
        "type": "text",
        "value": "tree "
      },
      [
        {
          "type": "text",
          "value": "leaf"
        }
      ],
      {
        "type": "text",
        "value": " "
      },
      [
        {
          "type": "text",
          "value": "leaf"
        }
      ]
    ],
    {
      "type": "text",
      "value": "\n"
    }
  ],
  {
    "type": "blank",
    "value": "\n"
  },
  [
    {
      "type": "text",
      "value": "data2-atom:\n"
    },
    {
      "type": "text",
      "value": "  atom\n"
    },
    {
      "type": "text",
      "value": "data2-list:\n"
    },
    {
      "type": "text",
      "value": "  "
    },
    [
      {
        "type": "text",
        "value": "list"
      }
    ],
    {
      "type": "text",
      "value": "\n"
    },
    {
      "type": "text",
      "value": "data2-tree:\n"
    },
    {
      "type": "text",
      "value": "  "
    },
    [
      {
        "type": "text",
        "value": "tree\n"
      },
      {
        "type": "text",
        "value": "    "
      },
      [
        {
          "type": "text",
          "value": "leaf"
        }
      ],
      {
        "type": "text",
        "value": "\n"
      },
      {
        "type": "text",
        "value": "    "
      },
      [
        {
          "type": "text",
          "value": "leaf"
        }
      ]
    ],
    {
      "type": "text",
      "value": "\n"
    }
  ],
  {
    "type": "blank",
    "value": "\n"
  },
  [
    {
      "type": "rawn",
      "delimiter": "DATA\n",
      "value": "data3-atom: atom\ndata3-list: [list]\ndata3-tree: [tree [leaf] [leaf]]\n"
    }
  ]
]
</pre>
